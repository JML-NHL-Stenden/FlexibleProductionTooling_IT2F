<!-- product_module/views/product_views.xml -->
<odoo>
    <!-- Product Type Views -->
    <record id="view_product_type_list" model="ir.ui.view">
        <field name="name">product.module.type.list</field>
        <field name="model">product_module.type</field>
        <field name="arch" type="xml">
            <list string="Categories">
                <field name="name"/>
                <field name="product_count" string="Total Products"/>
            </list>
        </field>
    </record>

    <record id="view_product_type_form" model="ir.ui.view">
        <field name="name">product.module.type.form</field>
        <field name="model">product_module.type</field>
        <field name="arch" type="xml">
            <form string="Category">
                <sheet>
                    <div class="pm-header-purple">
                        <div class="pm-header-content">
                            <div class="pm-image-container">
                                <field name="image" widget="image" options="{'size': [80, 80]}"/>
                            </div>
                            <div class="pm-flex-1">
                                <h1 class="pm-header-title">
                                    <field name="name" placeholder="Category Name" required="1" class="pm-header-field"/>
                                </h1>
                                <div class="pm-flex-center pm-margin-top-12">
                                    <span class="pm-badge">
                                        <i class="fa fa-cube"/> <field name="product_count"/> Variants
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pm-card">
                        <h3 class="pm-section-title">
                            <i class="fa fa-info-circle pm-icon-spacing pm-icon-blue"/> Category Information
                        </h3>
                        <div>
                            <label for="description" class="pm-label">Description</label>
                            <field name="description" placeholder="Describe this product category..." class="pm-field-description"/>
                        </div>
                    </div>

                    <div class="pm-card-no-margin">
                        <h3 class="pm-section-title">
                            <i class="fa fa-list pm-icon-spacing pm-icon-green"/> Products in this Category
                        </h3>
                        <div class="alert alert-info pm-margin-bottom-16" role="alert">
                            <i class="fa fa-lightbulb-o"/>
                            <strong>Tip:</strong> Use the field below to select products for this category. You can also assign products to categories when creating or editing them in the Product List tab.
                        </div>

                        <div class="o_form_label pm-label">Select Products:</div>
                        <field name="product_ids" widget="many2many_tags"
                               context="{'default_page_id': page_id}"
                               options="{'no_create': True}"/>
                        <div class="pm-info-text">
                            <i class="fa fa-info-circle"/> Selected products will appear as tags above. Products can belong to multiple categories.
                        </div>

                        <div class="pm-margin-top-20" invisible="not product_ids">
                            <h4 class="pm-section-title">
                                <i class="fa fa-list pm-icon-spacing pm-icon-green"/> Products in this Category
                            </h4>
                            <field name="product_ids" readonly="1">
                                <kanban>
                                    <field name="name"/>
                                    <field name="product_code"/>
                                    <field name="image"/>
                                    <templates>
                                        <t t-name="card">
                                            <div class="oe_kanban_card pm-kanban-card pm-kanban-card-green pm-width-280">
                                                <div class="oe_kanban_content pm-kanban-card-content">
                                                    <div class="pm-kanban-card-flex">
                                                        <div class="pm-image-container-small">
                                                            <field name="image" widget="image" options="{'size': [60, 60]}"/>
                                                        </div>
                                                        <div class="pm-flex-1-min-width">
                                                            <strong class="pm-kanban-title-inline">
                                                                <field name="name"/>
                                                            </strong>
                                                            <div class="pm-kanban-badge-container">
                                                                <span class="pm-badge-dark">
                                                                    <i class="fa fa-barcode"/> <field name="product_code"/>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                            </field>
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Product Views -->
    <record id="view_product_list" model="ir.ui.view">
        <field name="name">product.module.product.list</field>
        <field name="model">product_module.product</field>
        <field name="arch" type="xml">
            <list string="Products">
                <field name="sequence" widget="handle"/>
                <field name="name"/>
                <field name="product_code"/>
                <field name="product_type_ids" widget="many2many_tags"/>
                <field name="image" widget="image" options="{'size': [64, 64]}"/>
                <field name="instruction_count" string="Instructions"/>
            </list>
        </field>
    </record>

    <record id="view_product_form" model="ir.ui.view">
        <field name="name">product.module.product.form</field>
        <field name="model">product_module.product</field>
        <field name="arch" type="xml">
            <form string="Product Details">
                <sheet>
                    <div class="pm-header-green">
                        <div class="pm-header-content">
                            <div class="pm-image-container-large">
                                <field name="image" widget="image" options="{'size': [100, 100]}"/>
                            </div>
                            <div class="pm-flex-1">
                                <h1 class="pm-header-title">
                                    <field name="name" placeholder="Enter Product Name" required="1" class="pm-header-field"/>
                                </h1>
                                <div class="pm-flex-center">
                                    <span class="pm-badge">
                                        <i class="fa fa-barcode"/> <field name="product_code" required="1" class="pm-field-code"/>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pm-grid-2-1">
                        <div class="pm-card-no-margin">
                            <h3 class="pm-section-title">
                                <i class="fa fa-info-circle pm-icon-spacing" style="color: #007bff;"/> Product Information
                            </h3>
                            <div class="pm-field-group">
                                <div class="o_form_label pm-label">Product Categories</div>
                                <field name="product_type_ids" widget="many2many_tags" class="pm-width-100"/>
                                <div class="pm-info-text-small">
                                    <i class="fa fa-info-circle"/> Select multiple categories for this product. You can assign products to categories from both here and from the category management.
                                </div>
                            </div>
                            <div>
                                <label for="description" class="pm-label">Description</label>
                                <field name="description" placeholder="Enter detailed product description..." class="pm-field-full"/>
                            </div>
                        </div>

                        <div class="pm-card-no-margin">
                            <h3 class="pm-section-title">
                                <i class="fa fa-qrcode pm-icon-spacing pm-icon-purple"/> QR Code
                            </h3>
                            <div class="pm-qr-container">
                                <div class="pm-qr-box">
                                    <field name="qr_image" widget="image" filename="qr_image_name" options="{'size': [150, 150]}" style="max-width: 150px; max-height: 150px;"/>
                                    <div class="pm-qr-text">
                                        <field name="qr_text" readonly="1" class="pm-qr-field"/>
                                    </div>
                                </div>
                                <button name="action_download_qr" type="object" class="btn btn-primary btn-sm pm-margin-bottom-8" invisible="not id or not product_code">
                                    <i class="fa fa-download"/> Download QR Code
                                </button>
                                <div class="pm-info-text pm-text-center">
                                    QR code automatically generated from Product Code
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pm-card-no-margin">
                        <div class="pm-flex-row-spaced">
                            <h3 class="pm-section-title" style="margin: 0;">
                                <i class="fa fa-list-ol pm-icon-spacing pm-icon-orange"/> Assembly Instructions
                            </h3>
                            <div class="pm-flex-row" invisible="not id">
                                <button name="action_import_instructions" string="Import" type="object" class="btn btn-secondary"/>
                                <button name="action_export_instructions" string="Export" type="object" class="btn btn-secondary"/>
                            </div>
                        </div>
                        <div class="alert alert-info" role="alert" style="margin-bottom: 16px;">
                            <i class="fa fa-lightbulb-o"/>
                            <strong>Tip:</strong> Add step-by-step instructions to help users assemble this product. You can include images and detailed descriptions for each step.
                        </div>
                        <field name="instruction_ids" context="{'default_product_id': id}">
                            <list editable="bottom">
                                <field name="sequence" widget="handle"/>
                                <field name="title"/>
                                <field name="description" string="Description"/>
                            </list>
                            <form>
                                <sheet>
                                    <div class="pm-header-orange">
                                        <h4 class="pm-section-title-white">
                                            <i class="fa fa-list-ol pm-icon-spacing"/> Assembly Step
                                        </h4>
                                    </div>
                                    <group>
                                        <group>
                                            <field name="sequence"/>
                                            <field name="title"/>
                                        </group>
                                        <group>
                                            <field name="image" widget="image" class="oe_avatar"/>
                                        </group>
                                    </group>
                                    <group>
                                        <field name="description" placeholder="Enter detailed assembly instructions here..."/>
                                    </group>
                                </sheet>
                            </form>
                        </field>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Main Page View with Three Tabs -->
    <record id="view_product_assemble_form" model="ir.ui.view">
        <field name="name">product.assemble.page.form</field>
        <field name="model">product_module.page</field>
        <field name="arch" type="xml">
            <form string="Products">
                <sheet class="pm-sheet-full">
                    <div class="pm-header-purple">
                        <div class="pm-header-content-spaced">
                            <div>
                                <h1 class="pm-header-title-large">
                                    <i class="fa fa-cube pm-icon-spacing-large"/> <field name="name" readonly="1" class="pm-header-field-large"/>
                                </h1>
                                <p class="pm-header-subtitle">
                                    Organize your products into categories and manage your complete product catalog
                                </p>
                            </div>
                            <div class="pm-stats-container">
                                <div class="pm-stat-box">
                                    <div class="pm-stat-value">
                                        <field name="category_count"/>
                                    </div>
                                    <div class="pm-stat-label">Categories</div>
                                </div>
                                <div class="pm-stat-box">
                                    <div class="pm-stat-value">
                                        <field name="product_count"/>
                                    </div>
                                    <div class="pm-stat-label">Products</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <notebook>
                        <!-- TAB 1: Categories -->
                        <page string="Categories" name="product_categories">
                            <div class="alert alert-info" role="alert">
                                <i class="fa fa-info-circle"/>
                                <strong>Categories</strong> - Create categories to organize your products. Each category can contain multiple products.
                            </div>

                            <div class="pm-margin-bottom-16">
                                <button name="action_create_product_type" type="object" class="btn btn-primary pm-btn-primary-gradient">
                                    <i class="fa fa-plus pm-icon-spacing"/> Add New Category
                                </button>
                            </div>

                            <field name="product_type_ids" context="{'default_page_id': id}" widget="kanban">
                                <kanban create="false" multi_edit="1">
                                    <field name="name"/>
                                    <field name="product_count"/>
                                    <field name="image"/>
                                    <templates>
                                        <t t-name="card">
                                            <div class="oe_kanban_card oe_kanban_global_click pm-kanban-card pm-kanban-card-purple">
                                                <div class="oe_kanban_content pm-kanban-card-content">
                                                    <div class="pm-kanban-card-flex">
                                                        <div class="pm-image-container-kanban">
                                                            <field name="image" widget="image" options="{'size': [80, 80]}"/>
                                                        </div>

                                                        <div class="pm-flex-1">
                                                            <div class="pm-kanban-title">
                                                                <field name="name"/>
                                                            </div>

                                                            <div class="pm-badge-light">
                                                                <field name="product_count"/> Total Products
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                            </field>
                        </page>

                        <!-- TAB 2: Product List -->
                        <page string="Product List" name="product_list">
                            <div class="alert alert-success" role="alert">
                                <i class="fa fa-list"/>
                                <strong>Product Catalog</strong> - Manage all your products. Assign them to categories to organize and group similar products together.
                            </div>

                            <div class="pm-margin-bottom-16 pm-flex-row">
                                <button name="action_create_product" type="object" class="btn btn-success pm-btn-primary-gradient">
                                    <i class="fa fa-plus pm-icon-spacing"/> Add New Product
                                </button>

                                <div class="pm-info-box">
                                    <i class="fa fa-info-circle pm-icon-blue"/>
                                    <span class="pm-info-box-text">
                                        <strong>Tip:</strong> To assign products to categories, edit the category and select products, or edit individual products to set their category.
                                    </span>
                                </div>
                            </div>

                            <field name="product_ids" context="{'default_page_id': id}" widget="kanban">
                                <kanban create="false">
                                    <field name="name"/>
                                    <field name="product_code"/>
                                    <field name="product_type_ids"/>
                                    <field name="image"/>
                                    <field name="instruction_count"/>
                                    <field name="component_ids"/>
                                    <templates>
                                        <t t-name="card">
                                            <div class="oe_kanban_card oe_kanban_global_click pm-kanban-card pm-kanban-card-green">
                                                <div class="oe_kanban_content pm-kanban-card-content">
                                                    <div class="pm-kanban-card-flex">
                                                        <div class="pm-image-container-kanban">
                                                            <field name="image" widget="image" options="{'size': [80, 80]}"/>
                                                        </div>

                                                        <div class="pm-flex-1">
                                                            <div class="pm-kanban-title">
                                                                <field name="name"/>
                                                            </div>

                                                            <div class="pm-field-group-margin">
                                                                <div class="pm-kanban-text">
                                                                    <i class="fa fa-barcode" style="margin-right: 4px;"/> Product Code
                                                                </div>
                                                                <div class="pm-kanban-value">
                                                                    <field name="product_code" options="{'max_length': 16}"/>
                                                                </div>
                                                            </div>

                                                            <div class="pm-field-group-small">
                                                                <div class="pm-kanban-text">
                                                                    <i class="fa fa-folder pm-icon-spacing"/> Categories
                                                                </div>
                                                                <div class="pm-kanban-badge-container">
                                                                    <field name="product_type_ids" widget="many2many_tags" readonly="1" options="{'no_create': True}"/>
                                                                </div>
                                                            </div>

                                                            <div class="pm-field-group">
                                                                <div class="o_form_label pm-label">Components Used</div>
                                                                <field name="component_ids" widget="many2many_tags" class="pm-width-100"/>
                                                                <div class="pm-info-text-small">
                                                                    <i class="fa fa-info-circle"/> Select components used in this product
                                                                </div>
                                                            </div>

                                                            <!-- Arkite Project button inside each product card -->
                                                            <button name="action_create_arkite_project"
                                                                    type="object"
                                                                    class="btn btn-secondary pm-btn-full">
                                                                <i class="fa fa-project-diagram pm-icon-spacing"/> Create Arkite Project
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                            </field>
                        </page>

                        <!-- TAB 3: Components -->
                        <page string="Components" name="components">
                            <div class="alert alert-warning" role="alert">
                                <i class="fa fa-puzzle-piece"/>
                                <strong>Components</strong> - Manage product components and track which products use them.
                            </div>

                            <div class="pm-margin-bottom-16">
                                <button name="action_create_component" type="object" class="btn btn-warning pm-btn-warning-gradient">
                                    <i class="fa fa-plus pm-icon-spacing"/> Add New Component
                                </button>
                            </div>

                            <field name="component_ids" context="{'default_page_id': id}" widget="kanban">
                                <kanban create="false" multi_edit="1">
                                    <field name="name"/>
                                    <field name="component_type"/>
                                    <field name="usage_count"/>
                                    <field name="image"/>
                                    <templates>
                                        <t t-name="card">
                                            <div class="oe_kanban_card oe_kanban_global_click pm-kanban-card pm-kanban-card-red">
                                                <div class="oe_kanban_content pm-kanban-card-content">
                                                    <div class="pm-kanban-card-flex">
                                                        <div class="pm-image-container-kanban">
                                                            <field name="image" widget="image" options="{'size': [80, 80]}"/>
                                                        </div>

                                                        <div class="pm-flex-1">
                                                            <div class="pm-kanban-title">
                                                                <field name="name"/>
                                                            </div>

                                                            <div class="pm-field-group-small">
                                                                <div class="pm-kanban-text">
                                                                    <i class="fa fa-tag"/> Type
                                                                </div>
                                                                <div class="pm-kanban-value">
                                                                    <field name="component_type"/>
                                                                </div>
                                                            </div>

                                                            <div class="pm-badge-light">
                                                                <field name="usage_count"/> Products
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_product_type" model="ir.actions.act_window">
        <field name="name">Categories</field>
        <field name="res_model">product_module.type</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_product_type_list"/>
    </record>

    <record id="action_product" model="ir.actions.act_window">
        <field name="name">Products</field>
        <field name="res_model">product_module.product</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_product_list"/>
    </record>

    <record id="action_product_assemble_page" model="ir.actions.act_window">
        <field name="name">Products</field>
        <field name="res_model">product_module.page</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_product_assemble_form"/>
        <field name="res_id" ref="product_module.product_assemble_page_record"/>
        <field name="target">current</field>
        <field name="context">{'create': False, 'edit': True}</field>
    </record>

    <!-- Arkite Project Views -->
    <record id="view_arkite_project_list" model="ir.ui.view">
        <field name="name">product.module.arkite.project.list</field>
        <field name="model">product_module.arkite_project</field>
        <field name="arch" type="xml">
            <list string="Arkite Projects">
                <field name="product_name"/>
                <field name="product_code"/>
                <field name="qr_text"/>
            </list>
        </field>
    </record>

    <record id="view_arkite_project_form" model="ir.ui.view">
        <field name="name">product.module.arkite.project.form</field>
        <field name="model">product_module.arkite_project</field>
        <field name="arch" type="xml">
            <form string="Arkite Project">
                <sheet>
                    <group>
                        <field name="product_id"/>
                        <field name="product_name" readonly="1"/>
                        <field name="product_code" readonly="1"/>
                    </group>
                    <group>
                        <field name="qr_text" readonly="1"/>
                        <field name="qr_image" widget="image" readonly="1" options="{'size': [200, 200]}"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_arkite_project" model="ir.actions.act_window">
        <field name="name">Arkite Projects</field>
        <field name="res_model">product_module.arkite_project</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_arkite_project_list"/>
    </record>

    <!-- TOP-LEVEL APP MENU -->
    <record id="menu_product_module_root" model="ir.ui.menu">
        <field name="name">Product Module</field>
        <field name="sequence">10</field>
        <field name="action" eval="False"/>
        <field name="parent_id" eval="False"/>
    </record>

    <!-- Menu items -->
    <menuitem id="menu_products"
              name="Products"
              parent="menu_product_module_root"
              action="action_product_assemble_page"
              sequence="10"/>

    <menuitem id="menu_product_types"
              name="Categories"
              parent="menu_product_module_root"
              action="action_product_type"
              sequence="20"/>

    <menuitem id="menu_all_products"
              name="All Products"
              parent="menu_product_module_root"
              action="action_product"
              sequence="30"/>

    <menuitem id="menu_arkite_projects"
              name="Arkite Projects"
              parent="menu_product_module_root"
              action="action_arkite_project"
              sequence="40"/>

</odoo>
